[{"model": "qm.query", "pk": 1, "fields": {"name": "psexec_connect", "description": "Detect psexec network connections", "notes": "- To move around freely without attracting too much attention, attackers often use reliable software (one of the favorites is psexec) that looks normal in an enterprise environment.\r\n- Use the following aggregate to easily group by endpoint: `| group array_agg_distinct(dst.ip.address) by endpoint.name, src.process.cmdline`", "pub_date": "2023-03-16T08:02:46.204Z", "update_date": "2024-11-26T08:03:25.622Z", "pub_status": "DIST", "confidence": 2, "relevance": 3, "weighted_relevance": 1.5, "query": "endpoint.os = 'windows'\r\nand event.type = 'IP Connect'\r\nand src.process.name matches 'psexec\\\\.exe'", "columns": "| columns event.time, event.type, site.name, agent.uuid, src.process.storyline.id, src.process.user, src.process.uid, src.process.cmdline, src.ip.address, src.port.number, dst.ip.address, dst.port.number, src.process.parent.cmdline, tgt.process.cmdline", "emulation_validation": "", "references": "https://theitbros.com/using-psexec-to-run-commands-remotely/\r\nhttps://redcanary.com/blog/threat-hunting-psexec-lateral-movement/", "star_rule": false, "run_daily": true, "dynamic_query": false, "anomaly_threshold_count": 2, "anomaly_threshold_endpoints": 2, "tags": [1, 4], "mitre_techniques": [99, 9], "threats": [], "actors": [], "target_os": [1], "vulnerabilities": []}}, {"model": "qm.query", "pk": 2, "fields": {"name": "wsl_kali", "description": "Detect Kali Linux distribution via wsl.exe", "notes": "", "pub_date": "2023-03-16T05:57:24.277Z", "update_date": "2025-01-10T13:53:17.328Z", "pub_status": "DIST", "confidence": 4, "relevance": 1, "weighted_relevance": 1.0, "query": "endpoint.os = 'windows'\r\nand src.process.name matches 'wsl\\\\.exe' \r\nand src.process.parent.name matches 'kali'", "columns": "| columns event.time, event.type, site.name, agent.uuid, src.process.user, src.process.storyline.id, src.process.uid, src.process.cmdline, src.process.parent.cmdline", "emulation_validation": "", "references": "", "star_rule": false, "run_daily": true, "dynamic_query": false, "anomaly_threshold_count": 1, "anomaly_threshold_endpoints": 1, "tags": [1], "mitre_techniques": [72], "threats": [], "actors": [], "target_os": [1], "vulnerabilities": []}}, {"model": "qm.query", "pk": 146, "fields": {"name": "vulnerable_driver_name_detected_loldriver", "description": "Living Off The Land Drivers is a curated list of Windows drivers used by adversaries to bypass security controls and carry out attacks. The project helps security professionals stay informed and mitigate potential threats.", "notes": "- False positives may occur if one of the vulnerable driver names mentioned above didn't change its name between versions. So always make sure that the driver being loaded is the legitimate one and the non vulnerable version.\r\n- If you experience a lot of FP you could comment the driver name or its exact known legitimate location (when possible), or use the \"file hashes\" instead of the \"name\"", "pub_date": "2023-06-02T09:57:42.613Z", "update_date": "2025-01-12T03:00:05.122Z", "pub_status": "DRAFT", "confidence": 2, "relevance": 3, "weighted_relevance": 1.5, "query": "endpoint.os = 'windows'\n    and event.type = 'Driver Load'\n    and (\n      tgt.file.path contains:anycase ('\\\\elrawdsk.sys', '\\\\AsrSetupDrv103.sys', '\\\\daxin_blank6.sys', '\\\\Se64a.sys', '\\\\PanMonFlt.sys', '\\\\asio.sys', '\\\\t.sys', '\\\\smep_capcom.sys', '\\\\EIO.sys', '\\\\dcr.sys', '\\\\piddrv.sys', '\\\\ALSysIO64.sys', '\\\\ACE-BASE.sys', '\\\\WinFlash64.sys', '\\\\SysDrv3S.sys', '\\\\ni.sys', '\\\\2.sys', '\\\\prokiller64.sys', '\\\\WCPU.sys', '\\\\KApcHelper_x64.sys', '\\\\PanMonFltX64.sys', '\\\\KfeCo11X64.sys', '\\\\AsrDrv106.sys', '\\\\daxin_blank3.sys', '\\\\atillk64.sys', '\\\\EneIo64.sys', '\\\\HOSTNT.sys', '\\\\DBUtilDrv2.sys', '\\\\AsrDrv103.sys', '\\\\bwrsh.sys', '\\\\jnprva.sys', '\\\\BlackBoneDrv10.sys', '\\\\TfSysMon.sys', '\\\\BS_RCIO.sys', '\\\\LgDCatcher.sys', '\\\\AMDPowerProfiler.sys', '\\\\POORTRY1.sys', '\\\\amsdk.sys', '\\\\dbutil.sys', '\\\\kEvP64.sys', '\\\\BS_RCIO64.sys', '\\\\CupFixerx64.sys', '\\\\Bs_Def.sys', '\\\\vboxdrv.sys', '\\\\HwOs2Ec7x64.sys', '\\\\capcom.sys', '\\\\Phymemx64.sys', '\\\\ProtectS.sys', '\\\\msr.sys', '\\\\nt5.sys', '\\\\nstr.sys', '\\\\ASIO32.sys', '\\\\cpuz.sys', '\\\\wantd_3.sys', '\\\\nvflsh64.sys', '\\\\NetFlt.sys', '\\\\TGSafe.sys', '\\\\Dh_Kernel_10.sys', '\\\\EneTechIo64.sys', '\\\\NTIOLib_X64.sys', '\\\\4.sys', '\\\\SSPORT.sys', '\\\\HwRwDrv.sys', '\\\\BSMIx64.sys', '\\\\cpuz141.sys', '\\\\BSMEMx64.sys', '\\\\CorsairLLAccess64.sys', '\\\\BS_Flash64.sys', '\\\\HW.sys', '\\\\NodeDriver.sys', '\\\\gvcidrv64.sys', '\\\\TestBone.sys', '\\\\SANDRA', '\\\\UCOREW64.SYS', '\\\\krpocesshacker.sys', '\\\\ampa.sys', '\\\\t8.sys', '\\\\PanIO.sys', '\\\\AsUpIO.sys', '\\\\WINIODrv.sys', '\\\\nt2.sys', '\\\\ntbios_2.sys', '\\\\WYProxy64.sys', '\\\\cpuz_x64.sys', '\\\\inpoutx64.sys', '\\\\windows-xp-64.sys', '\\\\mJj0ge.sys', '\\\\b3.sys', '\\\\AsrOmgDrv.sys', '\\\\dbutil_2_3.sys', '\\\\wantd_4.sys', '\\\\d.sys', '\\\\CITMDRV_AMD64.sys', '\\\\vmdrv.sys', '\\\\HwOs2Ec10x64.sys', '\\\\amifldrv64.sys', '\\\\daxin_blank1.sys', '\\\\My.sys', '\\\\SysInfo.sys', '\\\\procexp.Sys')\n  or tgt.file.path contains:anycase ('\\\\nt6.sys', '\\\\AsrDrv10.sys', '\\\\libnicm.sys', '\\\\ene.sys', '\\\\ADRMDRVSYS.sys', '\\\\BS_HWMIO64_W10.sys', '\\\\full.sys', '\\\\AsrDrv102.sys', '\\\\0x3440_blacklotus_v2_driver.sys', '\\\\RTCore64.sys', '\\\\elbycdio.sys', '\\\\winio64.sys', '\\\\nt4.sys', '\\\\kbdcap64.sys', '\\\\bw.sys', '\\\\AsrSmartConnectDrv.sys', '\\\\WinIO32B.sys', '\\\\cpupress.sys', '\\\\LHA.sys', '\\\\DirectIo32.sys', '\\\\msrhook.sys', '\\\\NetProxyDriver.sys', '\\\\b.sys', '\\\\nstrwsk.sys', '\\\\wantd_5.sys', '\\\\mimidrv.sys', '\\\\gameink.sys', '\\\\b4.sys', '\\\\BS_RCIOW1064.sys', '\\\\Lurker.sys', '\\\\irec.sys', '\\\\asmmap64.sys', '\\\\fgme.sys', '\\\\mhyprot3.sys', '\\\\ViveRRAudio.sys', '\\\\AsrAutoChkUpdDrv.sys', '\\\\amp.sys', '\\\\d2.sys', '\\\\driver7-x86.sys', '\\\\b1.sys', '\\\\magdrvamd64.sys', '\\\\WinIo64B.sys', '\\\\Agent64.sys', '\\\\AsrDrv101.sys', '\\\\gftkyj64.sys', '\\\\IOMap64.sys', '\\\\CSC.sys', '\\\\superbmc.sys', '\\\\iomem64.sys', '\\\\semav6msr.sys', '\\\\c.sys', '\\\\GVCIDrv64.sys', '\\\\daxin_blank4.sys', '\\\\DirectIo.sys', '\\\\bandai.sys', '\\\\gmer64.sys', '\\\\MsIo64.sys', '\\\\AsrRapidStartDrv.sys', '\\\\zam64.sys', '\\\\ADV64DRV.sys', '\\\\daxin_blank5.sys', '\\\\viragt64.sys', '\\\\goad.sys', '\\\\mydrivers.sys', '\\\\windows8-10-32.sys', '\\\\rtkio64.sys', '\\\\dbk64.sys', '\\\\OpenLibSys.sys', '\\\\BS_I2c64.sys', '\\\\Truesight', '\\\\mhyprot.sys', '\\\\AsrIbDrv.sys', '\\\\MsIo32.sys', '\\\\dkrTK.sys', '\\\\NBIOLib_X64.sys', '\\\\rwdrv.sys', '\\\\TSDRVX64.sys', '\\\\wsdkd.sys', '\\\\daxin_blank.sys', '\\\\mtcBSv64.sys', '\\\\ProcObsrvesx.sys', '\\\\viragt.sys', '\\\\aswArPot.sys', '\\\\BS_HWMIo64.sys', '\\\\SeasunProtect.sys', '\\\\d3.sys', '\\\\wsftprm.sys', '\\\\wantd_2.sys', '\\\\piddrv64.sys', '\\\\Proxy64.sys', '\\\\ncpl.sys', '\\\\ATSZIO.sys', '\\\\sfdrvx32.sys', '\\\\LMIinfo.sys', '\\\\asrdrv104.sys', '\\\\Chaos-Rootkit.sys', '\\\\daxin_blank2.sys', '\\\\PhlashNT.sys', '\\\\amigendrv64.sys', '\\\\81.sys')\n  or tgt.file.path contains:anycase ('\\\\psmounterex.sys', '\\\\netfilterdrv.sys', '\\\\ElbyCDIO.sys', '\\\\otipcibus.sys', '\\\\GLCKIO2.sys', '\\\\PanIOx64.sys', '\\\\NQrmq.sys', '\\\\wantd.sys', '\\\\PcieCubed.sys', '\\\\smep_namco.sys', '\\\\PCHunter.sys', '\\\\AccelLid.sys', '\\\\ntbios.sys', '\\\\telephonuAfY.sys', '\\\\WinTapix.sys', '\\\\BEDAISY.SYS', '\\\\LcTkA.sys', '\\\\rzpnk.sys', '\\\\hw.sys', '\\\\t7.sys', '\\\\POORTRY.sys', '\\\\nscm.sys', '\\\\LenovoDiagnosticsDriver.sys', '\\\\pxitrig64.sys', '\\\\sandra.sys', '\\\\tboflhelper.sys', '\\\\TmComm.sys', '\\\\1.sys', '\\\\nvflash.sys', '\\\\fidpcidrv.sys', '\\\\directio64.sys', '\\\\fidpcidrv64.sys', '\\\\WinIo64C.sys', '\\\\HpPortIox64.sys', '\\\\BS_Def64.sys', '\\\\FairplayKD.sys', '\\\\WinIO32A.sys', '\\\\iQVW64.SYS', '\\\\Monitor_win10_x64.sys', '\\\\Proxy32.sys', '\\\\WinRing0.sys', '\\\\CITMDRV_IA64.sys', '\\\\aswVmm.sys', '\\\\driver7-x86-withoutdbg.sys', '\\\\WinIo64A.sys', '\\\\Afd.sys', '\\\\ndislan.sys', '\\\\echo_driver.sys', '\\\\NICM.SYS', '\\\\80.sys', '\\\\ktgn.sys', '\\\\AMDRyzenMasterDriver.sys', '\\\\physmem.sys', '\\\\eneio64.sys', '\\\\7.sys', '\\\\viraglt64.sys', '\\\\VBoxDrv.sys', '\\\\RwDrv.sys', '\\\\malicious.sys', '\\\\Dh_Kernel.sys', '\\\\kt2.sys', '\\\\wantd_6.sys', '\\\\d4.sys', '\\\\t3.sys', '\\\\bwrs.sys', '\\\\Lv561av.sys', '\\\\Black.sys', '\\\\LgCoreTemp.sys', '\\\\GameTerSafe.sys', '\\\\windows7-32.sys', '\\\\gdrv.sys', '\\\\phymem64.sys', '\\\\windbg.sys', '\\\\fiddrv64.sys', '\\\\NTIOLib.sys', '\\\\Air_SYSTEM10.sys', '\\\\nt3.sys', '\\\\834761775.sys', '\\\\BSMI.sys', '\\\\speedfan.sys', '\\\\POORTRY2.sys', '\\\\Sense5Ext.sys', '\\\\ktes.sys', '\\\\WinIO32.sys', '\\\\etdsupp.sys', '\\\\KfeCo10X64.sys', '\\\\MSqPq.sys', '\\\\NCHGBIOS2x64.SYS', '\\\\VProEventMonitor.sys', '\\\\fiddrv.sys', '\\\\wfshbr64.sys', '\\\\driver7-x64.sys', '\\\\BS_I2cIo.sys', '\\\\VBoxUSB.Sys')\n    )", "columns": "| columns event.time, event.type, endpoint.name, src.process.user, src.process.name, src.process.cmdline, src.process.parent.name, src.process.parent.cmdline, tgt.process.name, tgt.process.cmdline, tgt.file.path, tgt.file.sha256", "emulation_validation": "", "references": "https://www.loldrivers.io/", "star_rule": false, "run_daily": true, "dynamic_query": true, "anomaly_threshold_count": 2, "anomaly_threshold_endpoints": 2, "tags": [], "mitre_techniques": [], "threats": [], "actors": [], "target_os": [1], "vulnerabilities": []}}, {"model": "qm.query", "pk": 147, "fields": {"name": "apt45_ioc_20240729", "description": "## Description\r\n- APT45 is a long-running, moderately sophisticated North Korean cyber operator that has carried out espionage campaigns as early as 2009.\r\n- APT45 has gradually expanded into financially-motivated operations, and the groupâ€™s suspected development and deployment of ransomware sets it apart from other North Korean operators. \r\n- APT45 and activity clusters suspected of being linked to the group are strongly associated with a distinct genealogy of malware families separate from peer North Korean operators like TEMP.Hermit and APT43. \r\n- Among the groups assessed to operate from the Democratic People's Republic of Korea (DPRK), APT45 has been the most frequently observed targeting critical infrastructure.", "notes": "", "pub_date": "2025-02-23T15:17:14.227Z", "update_date": "2025-02-23T15:17:14.227Z", "pub_status": "DRAFT", "confidence": 4, "relevance": 4, "weighted_relevance": 4.0, "query": "tgt.file.sha256 in ('0c5e0a81efc0ccc406e5e6eaa222a79b491f4aa2938cf7cc72d0d027b53a9d99', '0e416e3cc1673d8fc3e7b2469e491c005152b9328515ea9bbd7cf96f1d23a99f', '1177105e51fa02f9977bd435f9066123ace32b991ed54912ece8f3d4fbeeade4', '152743ffa9df246e5f8c5687381121d8a66dfc05ca2ec2e58000caf964abafc2', '16db0063e4aa666d94752414549fa09fb33142481d894b01a0fae45b339a09fb', '2e500b2f160f927b1140fb105b83300ca21762c21bb6195c44e8dc613f7d7b12', '2eb16dbc1097a590f07787ab285a013f5fe235287cb4fb948d4f9cce9efa5dbc', '3cf63d516c580d8f988aa4f9b7d482bbdf3901dce435356dbca83eb311c32382', '42daf0f3080b50a0a1f14291f5ae3fa8fa400d838a915618f68a8f059777bcd4', '4e5e42b1acb0c683963caf321167f6985e553af2c70f5b87ec07cc4a8c09b4d8', '58fef66f346fe3ed320e22640ab997055e54c8704fc272392d71e367e2d1c2bb', '60425a4d5ee04c8ae09bfe28ca33bf9e76a43f69548b2704956d0875a0f25145', '6319102bac226dfc117c3c9e620cd99c7eafbf3874832f2ce085850aa042f19c', '655aa64860f1655081489cf85b77f72a49de846a99dd122093db4018434b83ae', '6ca3c2a6001f1149ff75ab46402dee40d97602bab0b43ac144ca70fbd2101404', '782791c9ec3550cd522fd27b992e75381d5c5bc4d95b2f3934f9af6b6d5a57f4', '789c3aeb31700b078f6449cb310b4a2b7d8c03aefeed46a69b1dcb40a18001a7', '846c2a02505dc1463019cabc021969f7f6095215efb63ec374da1d055e778390', '8aa6612c95c7cef49709596da43a0f8354f14d8c08128c4cb9b1f37e548f083b', '8bc74559c3678d299826755f29d5ba75b1148b0f8d1fa71a120b2f879f85f08b', '90fb0cd574155fd8667d20f97ac464eca67bdb6a8ee64184159362d45d79b6a4', 'a0a0b0dd33b5b685317f6abe7b4caf0610938f548f6d178919bf43c24e1a3a4b', 'a1990d863e0b5c7661358dab72ce9223e2d54570915105707374ea8cf68828bd', 'ac5e0ec03658a281bb57e8b1b17f1fa1da2c819a373524577459c63b0b9d9a75', 'afb2d4d88f59e528f0e388705113ae54b7b97db4f03a35ae43cc386a48f263a0', 'b7435d23769e79fcbe69b28df4aef062685d1a631892c2354f96d833eae467be', 'c28bb61de4a6ad1c5e225ad9ec2eaf4a6c8ccfff40cf45a640499c0adb0d8740', 'c8fb5988ad3f71412cb5b4f1248df7ddf82c8c5f3dce60c73c4787b6e443b7b0', 'c9724eecab6cfb1c312d4538630fdac0d30434c0cffa131f9190e5a76bef6304', 'cb4d45338798b97177d8d96eea82dae22481dada40174dda0386026d11136209', 'd30abdf9db88da8a23dccb8188cd4caff48bc437bb3eb3ad576a013ff675161a', 'e263aa0e7e6a6a1d59677eaf2d4ccb848fe65a84035ab4f24c4e26a1ab089c79', 'e8e61112e8b896ad00ddefb42feb33e5d0fc38d2fb462b9f980606fe79d42571', 'ed8ec7a8dd089019cfd29143f008fa0951c56a35d73b2e1b274315152d0c0ee6', 'f5f6e538001803b0aa008422caf2c3c2a79b2eeee9ddc7feda710e4aba96fea4', 'f67ee77d6129bd1bcd5d856c0fc5314169b946d32b8abaa4e680bb98130b38e7', 'f93ddb2377e02b0673aac6d540a558f9e47e611ab6e345a39fd9b1ba9f37cd22')", "columns": "| columns event.time, event.type, site.name, agent.uuid, src.process.user, src.process.uid, src.process.cmdline, tgt.file.path, tgt.file.sha256", "emulation_validation": "", "references": "https://cloud.google.com/blog/topics/threat-intelligence/apt45-north-korea-digital-military-machine?hl=en\r\nhttps://www.virustotal.com/gui/collection/ba02ba3529e90a07e00dc81074c3a6180e2a3fb906e81518cf9974526212a11b/iocs", "star_rule": false, "run_daily": true, "dynamic_query": false, "anomaly_threshold_count": 2, "anomaly_threshold_endpoints": 2, "tags": [15, 11], "mitre_techniques": [22, 455, 543, 167, 26, 8, 281, 114, 45, 248, 193, 183], "threats": [1, 2], "actors": [1], "target_os": [1], "vulnerabilities": []}}, {"model": "qm.query", "pk": 148, "fields": {"name": "suspicious_modifications_to_esx_admins_group", "description": "##Description\r\nMicrosoft researchers have uncovered a vulnerability in ESXi hypervisors being exploited by several ransomware operators to obtain full administrative permissions on domain-joined ESXi hypervisors. ESXi is a bare-metal hypervisor that is installed directly onto a physical server and provides direct access and control of underlying resources. ESXi hypervisors host virtual machines that may include critical servers in a network. In a ransomware attack, having full administrative permission on an ESXi hypervisor can mean that the threat actor can encrypt the file system, which may affect the ability of the hosted servers to run and function. It also allows the threat actor to access hosted VMs and possibly to exfiltrate data or move laterally within the network.\r\n\r\nThe vulnerability, identified as CVE-2024-37085, involves a domain group whose members are granted full administrative access to the ESXi hypervisor by default without proper validation. Microsoft disclosed the findings to VMware through Coordinated Vulnerability Disclosure (CVD) via Microsoft Security Vulnerability Research (MSVR), and VMWare released a security update. Microsoft recommends ESXi server administrators to apply the updates released by VMware to protect their servers from related attacks, and to follow the mitigation and protection guidance we provide in this blog post. We thank VMWare for their collaboration in addressing this issue.", "notes": "", "pub_date": "2025-02-23T15:26:28.178Z", "update_date": "2025-02-23T15:26:28.178Z", "pub_status": "DRAFT", "confidence": 4, "relevance": 4, "weighted_relevance": 4.0, "query": "src.process.cmdline matches 'ESX\\\\s+Admins'", "columns": "| columns event.time, event.type, site.name, agent.uuid, src.process.user, src.process.storyline.id, src.process.uid, src.process.cmdline, src.process.parent.cmdline, tgt.process.cmdline", "emulation_validation": "", "references": "https://www.microsoft.com/en-us/security/blog/2024/07/29/ransomware-operators-exploit-esxi-hypervisor-vulnerability-for-mass-encryption/", "star_rule": false, "run_daily": true, "dynamic_query": false, "anomaly_threshold_count": 2, "anomaly_threshold_endpoints": 2, "tags": [10], "mitre_techniques": [178], "threats": [3], "actors": [], "target_os": [1], "vulnerabilities": [1]}}]